let skd='<div style="position: absolute;width: 62px;height: 42px;transform: rotate(329deg);top: -10px;left: 36px;border: 2px solid #d2d2d2;border-radius: 50%;box-sizing: border-box;border-color: #d8d8d8 #d6d6d6 transparent transparent;"></div><div style="position: absolute;width: 98px;height: 71px;transform: rotate(329deg);top: -23px;left: 34px;border: 2px solid black;border-radius: 50%;box-sizing: border-box;border-color: #eaeaea #ffffff transparent transparent"></div><div style="position: absolute;width: 20px;height: 23px;transform: rotate(317deg);top: 35px;left: 67px;border: 2px solid black;border-radius: 50%;box-sizing: border-box;border-color: transparent transparent #ffffff #ffffff"></div><div style="position: absolute;width: 52px;height: 56px;transform: rotate(317deg);top: 17px;left: 67px;border: 2px solid black;border-radius: 50%;box-sizing: border-box;border-color: transparent transparent #ffffff #ffffff"></div><div style="position: absolute;top: -4px;left: 85px;width: 20px;height: 20px;background: #fafafa;color: #000000;text-align: center;line-height: 14px;font-size: 12px;transform: rotate(361deg);clip-path: polygon(50% 100%, 0 0, 100% 0)">1</div><div style="position: absolute;top: -4px;left: 116px;width: 20px;height: 20px;background: #fafafa;color: #000000;text-align: center;line-height: 14px;font-size: 12px;transform: rotate(361deg);clip-path: polygon(50% 100%, 0 0, 100% 0)">2</div><div style="position: absolute;top: 34px;left: 77px;width: 20px;height: 20px;background: #fafafa;color: #000000;text-align: center;line-height: 24px;font-size: 12px;transform: rotate(28deg);clip-path: polygon(50% 0%, 0 100%, 100% 100%)">3</div><div style="position: absolute;top: 36px;left: 109px;width: 20px;height: 20px;background: #fafafa;color: #000000;text-align: center;line-height: 24px;font-size: 12px;transform: rotate(10deg);clip-path: polygon(50% 0%, 0 100%, 100% 100%)">4</div>';function getTopicList(){var n={};return document.querySelectorAll("#mcq-list li").forEach(function(e){var t=e.getAttribute("data-file").replace(".json","");n[t]=e.textContent.trim()}),n}var topic_list=getTopicList(),catid="";const popup=document.getElementById("explanation-popup");let allQuestions=[],currentQuestionIndex=0,selectedAnswerIndex=null,stats={},currentTopic=null,currentFileNumber=0,isExam=!1;function setCookie(e,t,n=365){n=new Date(Date.now()+24*n*60*60*1e3).toUTCString();document.cookie=`${e}=${encodeURIComponent(JSON.stringify(t))}; expires=${n}; path=/`}function getCookie(e){e=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return e?JSON.parse(decodeURIComponent(e[2])):null}let examStats=getCookie("examStats")||{scores:[],topics:{}},currentExamTopicResults={},currentExamScore=0;async function loadQuestions(t){catid=t,isExam=!1;try{var e=await fetch(t);if(!e.ok)throw new Error("HTTP error! status: "+e.status);if((allQuestions=await e.json()).forEach(e=>{e.catID=+t.split(".")[0]}),!Array.isArray(allQuestions))throw new Error("JSON data is not an array");shuffleArray(allQuestions),currentQuestionIndex=0,showQuestion(allQuestions[currentQuestionIndex]),updateStatsDisplay()}catch(e){console.error("Detailed Error:",e),document.getElementById("questions-container").innerHTML=`<p style="color:red;">Error loading questions: ${e.message}</p>
 <button onclick="loadQuestions('${t}')">Retry</button>`}}function shuffleArray(t){for(let e=t.length-1;0<e;e--){var n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function showQuestion(n){document.getElementById("scores-panel").style.display="none",document.getElementById("tutes-panel").style.display="block";var e,t,o=document.getElementById("questions-container");console.log(n);let s="",a=0,i=(n.options.forEach((e,t)=>{a++,cc=t==n.answerIndex?"cc":"",s+=`<li data-index="${t}" class="${cc}">${a}) ${e}</li>`}),`
<div class="question-container">
<div class="question">${n.question}</div>
`);isExam?(i+=`
<div class="options">
  <ul>${s}</ul>
</div>`,document.getElementById("explain-btn").style.display="none"):document.getElementById("explain-btn").style.display="block",i+="</div>",o.innerHTML=i,selectedAnswerIndex=null,"35"!=n.catID&&"36"!=n.catID||(e=document.querySelector(".question"),(t=document.createElement("div")).className="graph-container",e.appendChild(t),createGraphSVG(".graph-container"),updateGraph(document.querySelector(".question .hidden")?.innerHTML,!0));const r=o.querySelectorAll(".options li");r.forEach(e=>{e.addEventListener("click",()=>{r.forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),selectedAnswerIndex=parseInt(e.dataset.index,10),checkAnswer(n)})}),document.getElementById("explain-btn").onclick=()=>{showExplanation(n.explanation,n.question)},window.MathJax&&(MathJax.typesetClear(),MathJax.typesetPromise([o]))}function showNextQuestion(){currentQuestionIndex<allQuestions.length-1?(currentQuestionIndex++,showQuestion(allQuestions[currentQuestionIndex])):isExam?finishExam():(shuffleArray(allQuestions),currentQuestionIndex=0,showQuestion(allQuestions[currentQuestionIndex]))}function showPreviousQuestion(){0<currentQuestionIndex&&(currentQuestionIndex--,showQuestion(allQuestions[currentQuestionIndex]))}function showExplanation(e,t){var n;document.getElementById("explanation-quiz").innerHTML=t,document.getElementById("explanation-text").innerHTML="<h4>‡∑Ä‡∑í‡∑É‡∂≥‡∑î‡∂∏:</h4>"+e.replace(/<br\s*\/?>/gi,'<div class="divider"></div>'),popup.classList.add("show"),window.MathJax&&(MathJax.typesetClear([popup]),MathJax.typesetPromise([popup])),"11.json"==catid&&document.querySelectorAll("#explanation-text .sadk").forEach(e=>{e.insertAdjacentHTML("beforeend",skd)}),"1.json"==catid&&(e=document.getElementById("explanation-text"),(n=document.createElement("div")).className="line-container",e.appendChild(n),visualizeOperation(t.replace(/\$\$/g,"").trim(),"line-container"))}function updateStatsDisplay(){var e,t=document.getElementById("stats-box");t&&(e=stats[currentTopic]||{correct:0,wrong:0},t.innerHTML=`‚úÖ Correct: ${e.correct} | ‚ùå Wrong: `+e.wrong)}async function loadLiveExamQuestions(){isExam=!0,currentExamTopicResults={},currentExamScore=0;const e=[];Object.keys(topic_list).forEach(t=>{const n=t+".json";e.push(fetch(n).then(e=>e.ok?e.json():[]).then(e=>{return Array.isArray(e)&&0!==e.length?((e=e[Math.floor(Math.random()*e.length)])._topic=t.toString(),e.catID=+t,e):null}).catch(e=>(console.warn("Failed to load "+n,e),null)))});var t=await Promise.all(e);(allQuestions=t.filter(Boolean)).length?(shuffleArray(allQuestions),currentQuestionIndex=0,showQuestion(allQuestions[0])):document.getElementById("questions-container").innerHTML='<p style="color:red;">No exam questions available</p>'}function checkAnswer(e){var t;null!==selectedAnswerIndex&&(t=selectedAnswerIndex===e.answerIndex,isExam)&&e._topic&&(currentExamTopicResults[e._topic]=t?1:0)}function finishExam(){let t=0;Object.values(currentExamTopicResults).forEach(e=>{1===e&&t++}),examStats.scores.push(t),10<examStats.scores.length&&examStats.scores.shift(),Object.entries(currentExamTopicResults).forEach(([e,t])=>{examStats.topics[e]||(examStats.topics[e]=[]),examStats.topics[e].push(t),10<examStats.topics[e].length&&examStats.topics[e].shift()}),setCookie("examStats",examStats),showFinalScorePopup(t)}function showFinalScorePopup(){var e=Object.keys(currentExamTopicResults).length,t=(currentExamScore/e*100).toFixed(1);let n="";Object.entries(currentExamTopicResults).forEach(([e,t])=>{0===t&&(n+=`<li>Topic ${e}</li>`)}),document.getElementById("explanation-quiz").innerHTML="üìä Exam Result",document.getElementById("explanation-text").innerHTML=`
<p><b>Score:</b> ${currentExamScore} / ${e}</p>
<p><b>Success:</b> ${t}%</p>
<h4>Weak Topics</h4>
<ul>${n||"<li>None üéâ</li>"}</ul>
<button class="start-exam-btn" onclick="closePopup()">Close</button>
`,popup.classList.add("show")}function showLiveExamPopup(){document.getElementById("explanation-text").innerHTML=`
<div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; border: 2px solid #4A90E2; border-radius: 10px; padding: 20px; max-width: 400px; ">
<ul style="list-style-type: none; padding: 0; line-height: 1.8;">
  <li>üìù ‡∂∏‡∑ô‡∂∫ ‡∂ö‡∑ô‡∂ß‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 40‡∂ö ‡∑Ä‡∑í‡∂∑‡∑è‡∂ú‡∂∫‡∂ö‡∑í</li>  
  <li>‚úÖ ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ì ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂ö‡∂Ω‡∑ä‡∂¥ 4‡∂±‡∑ä ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í ‡∂¥‡∑í‡∂Ω‡∑í‡∂≠‡∑î‡∂ª ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±</li>
  <li>‚è±Ô∏è ‡∂ö‡∑è‡∂Ω‡∂∫ ‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ú‡∑ê‡∂± ‡∑É‡∑ê‡∂Ω‡∂ö‡∑í‡∂Ω‡∑í‡∂∏‡∂≠‡∑ä ‡∑Ä‡∂±‡∑ä‡∂±</li>
  <li>üß† ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∑É‡∑í‡∂∫‡∂Ω‡∑ä‡∂Ω ‡∑Ñ‡∑ú‡∂≥‡∑í‡∂±‡∑ä ‡∂ö‡∑í‡∂∫‡∑Ä‡∑è ‡∂Ö‡∑Ä‡∂∂‡∑ù‡∂∞ ‡∂ö‡∂ª‡∂ú‡∂±‡∑ä‡∂±</li>
</ul>
<div style="margin-top: 20px; text-align: center; font-weight: bold; ">
  ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∑Ä‡∑í‡∂∑‡∑è‡∂ú‡∂∫‡∂ß ‡∂∏‡∑î‡∑Ñ‡∑î‡∂´ ‡∂Ø‡∑ì‡∂∏‡∂ß ‡∑É‡∑î‡∂∑ ‡∂¥‡∂≠‡∂∏‡∑î!
</div>
<button class="start-exam-btn" onclick="closePopup();loadLiveExamQuestions()" 
style="background: linear-gradient(112deg, #009688, #009688, #43A047);
padding: 10px;
border: none;
border-radius: 5px;
color: #fff;cursor:pointer"
>‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
</div>
`,popup.classList.add("show")}function closePopup(){popup.classList.remove("show")}document.getElementById("menu-toggle").addEventListener("click",()=>{document.getElementById("topic-list").classList.toggle("open")});const menuToggle=document.getElementById("menu-toggle"),topicList=document.getElementById("topic-list");document.addEventListener("click",e=>{menuToggle.contains(e.target)||topicList.contains(e.target)||topicList.classList.remove("open")}),topicList.addEventListener("click",e=>{(e.target.closest("#topic-list ul ul li")||e.target.closest("#mcq-list li"))&&topicList.classList.remove("open"),e.target.closest("#topic-list li")?.querySelector(":scope > ul")||topicList.classList.remove("open")}),document.getElementById("mcq-list").addEventListener("click",e=>{"LI"===e.target.tagName&&(document.getElementById("mcq-list").classList.remove("open"),popup.classList.remove("show"))}),document.addEventListener("DOMContentLoaded",()=>{var e=document.querySelector("#mcq-list li[data-file]"),t=(e&&loadQuestions(e.dataset.file),document.getElementById("mcq-list"));t.addEventListener("click",e=>{e=e.target.closest("li");e&&e.parentElement===t&&(t.querySelectorAll("li").forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),loadQuestions(e.dataset.file))}),document.getElementById("next-btn").onclick=showNextQuestion,document.getElementById("prev-btn").onclick=showPreviousQuestion,document.addEventListener("click",e=>{e.target.closest(".live_test")&&(e.preventDefault(),showLiveExamPopup())})}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("#topic-list > li").forEach(t=>{t.querySelector(":scope > ul")&&t.addEventListener("click",e=>{e.target.closest("ul")!==t.querySelector(":scope > ul")&&(e.stopPropagation(),t.classList.toggle("open"))})})}),document.getElementById("scores").addEventListener("click",()=>{renderScoreCharts()});let examChart=null,topicChart=null;function renderScoreCharts(){document.getElementById("scores-panel").style.display="block",document.getElementById("tutes-panel").style.display="none";var e=getCookie("examStats");e&&(renderExamLineChart(document.getElementById("examChartWrapper"),e.scores),renderTopicBarChart(document.getElementById("topicChartWrapper"),e.topics))}function renderExamLineChart(e,t){var n=e.querySelector("canvas"),e=e.querySelector(".chart-empty");t&&0!==t.length?(n.style.display="block",e.style.display="none",n=n.getContext("2d"),examChart=new Chart(n,{type:"line",data:{labels:t.map((e,t)=>"Exam "+(t+1)),datasets:[{data:t,borderWidth:2,tension:.3}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,min:0,max:42}},plugins:{legend:{display:!1}}}})):(e.style.display="flex",examChart&&examChart.destroy())}function renderTopicBarChart(e,t){var n=document.getElementById("topicChart"),o=n.getContext("2d"),s=e.querySelector(".chart-empty");if(t&&0!==t.length){n.style.display="block",s.style.display="none",topicChart&&topicChart.destroy();const a=[],i=[];Object.entries(t).forEach(([e,t])=>{topic_list[e]&&(e=topic_list[e],a.push(wrapLabel(e,25)),i.push(t.reduce((e,t)=>e+t,0)))});e.style.height=35*i.length+"px",topicChart=new Chart(o,{type:"bar",data:{labels:a,datasets:[{data:i,barThickness:30,categoryPercentage:.5,barPercentage:.9}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{beginAtZero:!0,min:0,max:10,ticks:{autoSkip:!1}},y:{ticks:{autoSkip:!1}}},plugins:{legend:{display:!1}}}})}else s.style.display="flex"}function wrapLabel(e,t=30){if(e.length<=t)return e;let n="",o="";for(const s of e.split(" "))(n+s).length<=t?n+=(n?" ":"")+s:o+=(o?" ":"")+s;return[n,o]}
