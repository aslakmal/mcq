let tooltipDiv=null,currentGraphPoints=[],highlightedLabels=[];function getOrCreateTooltip(){return tooltipDiv||((tooltipDiv=document.createElement("div")).id="tooltip",tooltipDiv.style.cssText=`
                position: absolute;
                background-color: rgba(51, 51, 51, 0.9);
                color: #fff;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.2s;
                z-index: 1000;
                white-space: nowrap;
            `,document.body.appendChild(tooltipDiv)),tooltipDiv}function showTooltip(t,e,i){var r=getOrCreateTooltip();r.innerHTML=`ඛණ්ඩාංක: (${Math.round(e)}, ${Math.round(i)})<br>x=${Math.round(e)} වනවිට y=`+Math.round(i),0==Math.round(e)&&(r.innerHTML+="<br> අණ්තඃඛණ්ඩය: "+Math.round(i)),r.style.left=t.pageX+10+"px",r.style.top=t.pageY+10+"px",r.style.opacity=1,highlightAxisLabels(Math.round(e),Math.round(i))}function hideTooltip(){getOrCreateTooltip().style.opacity=0,clearAxisHighlights()}function highlightAxisLabels(i,r){clearAxisHighlights(),graphSVG.querySelectorAll("text").forEach(t=>{var e=parseInt(t.textContent);e===i&&t.id.startsWith("x-")&&(t.classList.add("highlight-axis-label"),highlightedLabels.push(t)),e===r&&t.id.startsWith("y-")&&(t.classList.add("highlight-axis-label"),highlightedLabels.push(t))})}function clearAxisHighlights(){highlightedLabels.forEach(t=>{t.classList.remove("highlight-axis-label")}),highlightedLabels=[]}function parseEquation(t){let e=0,i=0,r=0,a="linear",n=!0,o=t.toLowerCase().replace(/\s/g,"");if(""===(o=o.startsWith("y=")?o.substring(2):o))return{a:0,m:0,c:0,type:"linear",valid:!0};let l=o;var t=(t,e)=>{e=parseFloat(e||"1");return isNaN(e)?0:"-"===t?-e:e},s=l.match(/^([+\-]?)(\d*\.?\d*)x\^2/);s&&(e=t(s[1],s[2]),l=l.substring(s[0].length),a="quadratic"),(s=l.match(/^([+\-]?)(\d*\.?\d*)x(?!\d)/))&&(i=t(s[1],s[2]),l=l.substring(s[0].length));return(s=l.match(/^([+\-]?)(\d*\.?\d+)$/))&&(r=t(s[1],s[2]),l=l.substring(s[0].length)),(0<l.length||isNaN(e)||isNaN(i)||isNaN(r))&&(n=!1),"0"===o?{a:0,m:0,c:0,type:"linear",valid:!0}:{a:e,m:i,c:r,type:a,valid:n}}function interpolatePoints(e,i,r){var a=[],n=Math.min(e.length,i.length);for(let t=0;t<n;t++){var o=(e[t]?e:i)[t][0],l=(e[t]?e:i)[t][1],s=i[t][0],h=i[t][1];a.push(o+(s-o)*r+","+(l+(h-l)*r))}return a.join(" ")}function animateLine(r,a,n,o,l){const s=performance.now();requestAnimationFrame(function t(){var e=performance.now()-s,e=Math.min(e/o,1),e=1-Math.pow(1-e,2),i=interpolatePoints(a,n,e);r.setAttribute("points",i),e<1?requestAnimationFrame(t):l&&l()})}function renderDots(t,i=!1){dotsGroup.innerHTML="";t.forEach(t=>{var e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",t.x_svg),e.setAttribute("cy",t.y_svg),e.setAttribute("r",.15),e.setAttribute("fill","#2563eb"),e.style.cursor="pointer",e.dataset.xVal=t.x_math.toString(),e.dataset.yVal=t.y_math.toString(),i||e.addEventListener("mouseover",t=>showTooltip(t,parseFloat(t.target.dataset.xVal),parseFloat(t.target.dataset.yVal))),e.addEventListener("mouseout",hideTooltip),dotsGroup.appendChild(e)})}function updateGraph(t,e=!1){var{a:i,m:r,c:a,type:n}=parseEquation(t),o=[];const l=[];for(let e=-10;e<=10;e+=.1){let t;"linear"===n?t=r*e+a:"quadratic"===n&&(t=i*e*e+r*e+a);var s=-t;o.push([e,s])}for(let e=Math.floor(-10);e<=Math.ceil(10);e+=1){let t;"linear"===n?t=r*e+a:"quadratic"===n&&(t=i*e*e+r*e+a);var h=-t;l.push({x_math:e,y_math:t,x_svg:e,y_svg:h})}let p=[];t=graphLine.getAttribute("points");t&&(p=t.split(" ").map(t=>t.split(",").map(Number))),dotsGroup.innerHTML="",hideTooltip(),clearAxisHighlights(),0===p.length||p.length!==o.length?(graphLine.setAttribute("points",o.map(t=>t[0]+","+t[1]).join(" ")),renderDots(l,e)):animateLine(graphLine,p,o,500,()=>{renderDots(l,e)}),currentGraphPoints=o}function createGraphSVG(t){var e=document.querySelector(t);if(e){var i,r,a=d("svg",{id:"graphSVG",viewBox:"-10 -10 20 20"}),n=d("defs"),o=d("clipPath",{id:"graphAreaClip"}),l=d("rect",{x:"-10",y:"-10",width:"20",height:"20"}),s=(o.appendChild(l),n.appendChild(o),a.appendChild(n),"#e0e0e0");for(let t=-9;t<=9;t++)0!==t&&(i=d("line",{x1:"-10",y1:t,x2:"10",y2:t,stroke:s,"stroke-width":"0.02"}),a.appendChild(i));for(let t=-9;t<=9;t++)0!==t&&(r=d("line",{x1:t,y1:"-10",x2:t,y2:"10",stroke:s,"stroke-width":"0.02"}),a.appendChild(r));var l="black",h=(a.appendChild(d("line",{x1:"-10",y1:"0",x2:"10",y2:"0",stroke:l,"stroke-width":"0.06"})),a.appendChild(d("polygon",{points:"9.7 0.3, 10 0, 9.7 -0.3",fill:l})),a.appendChild(d("text",{x:"9.5",y:"-0.8","font-size":"0.8","text-anchor":"middle",fill:l},"x")),a.appendChild(d("line",{x1:"0",y1:"-10",x2:"0",y2:"10",stroke:l,"stroke-width":"0.06"})),a.appendChild(d("polygon",{points:"0.3 -9.7, 0 -10, -0.3 -9.7",fill:l})),a.appendChild(d("text",{x:"-1",y:"-9.5","font-size":"0.8","text-anchor":"middle",fill:l},"y")),a.appendChild(d("text",{x:"-0.5",y:"0.7","font-size":"0.5",fill:l},"0")),a.appendChild(d("polyline",{id:"graphLine",fill:"none",stroke:"#4CAF50","stroke-width":"0.06",class:"line-shadow","clip-path":"url(#graphAreaClip)"})),a.appendChild(d("g",{id:"dotsGroup","clip-path":"url(#graphAreaClip)"})),"0.5"),p="gray";for(let t=1;t<=9;t++)a.appendChild(d("text",{id:"x-"+t,x:t,y:"0.7","font-size":h,"text-anchor":"middle",fill:p},t.toString())),a.appendChild(d("text",{id:"x-minus-"+t,x:-t,y:"0.7","font-size":h,"text-anchor":"middle",fill:p},"-"+t));for(let t=1;t<=9;t++)a.appendChild(d("text",{id:"y-"+t,x:"-0.7",y:-t,"font-size":h,"text-anchor":"start",fill:p},t.toString())),a.appendChild(d("text",{id:"y-minus-"+t,x:"-0.7",y:t,"font-size":h,"text-anchor":"start",fill:p},"-"+t));return e.innerHTML="",e.appendChild(a),a}function d(t,e,i=null){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(const a in e)e.hasOwnProperty(a)&&r.setAttribute(a,e[a]);return null!==i&&(r.textContent=i),r}console.error("Container element not found with selector: "+t)}
